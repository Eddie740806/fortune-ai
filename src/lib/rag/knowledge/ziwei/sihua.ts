/**
 * 四化知識庫
 * 化祿、化權、化科、化忌的含義
 */

export interface SiHuaKnowledge {
  name: string;
  nature: string;
  generalMeaning: string[];
  inPalace: Record<string, string>;
}

export const SIHUA_KNOWLEDGE: Record<string, SiHuaKnowledge> = {
  '化祿': {
    name: '化祿',
    nature: '財祿、順遂、緣分、機會',
    generalMeaning: [
      '代表順利、機會、財運、緣分',
      '事情容易成功，有貴人相助',
      '心態樂觀，容易滿足',
      '人緣好，容易得到幫助',
      '有偏財運，意外收穫',
    ],
    inPalace: {
      '命宮': '一生順遂，有福氣，人緣好，容易心想事成。',
      '兄弟宮': '與兄弟姐妹關係好，可能從手足處得利。',
      '夫妻宮': '感情緣分好，婚姻有助力，配偶帶財。',
      '子女宮': '與子女緣分深，子女有出息，或從子女處得利。',
      '財帛宮': '財運極佳，賺錢順利，有偏財運。',
      '疾厄宮': '身體底子好，有病也容易好轉。',
      '遷移宮': '出外順利，貴人多，適合往外發展。',
      '交友宮': '朋友多，人緣好，可能從朋友處獲益。',
      '官祿宮': '事業順利，工作有成就，有升遷機會。',
      '田宅宮': '有房產運，家庭和諧，祖業有蔭。',
      '福德宮': '心態好，有福享，精神愉快。',
      '父母宮': '與父母緣分好，可能得到長輩幫助。',
    },
  },

  '化權': {
    name: '化權',
    nature: '權力、掌控、努力、成就',
    generalMeaning: [
      '代表權力、掌控、主導權',
      '需要靠努力爭取，不是輕鬆得來',
      '有企圖心，想要掌控局面',
      '適合當領導或負責人',
      '可能有壓力，但也有成就感',
    ],
    inPalace: {
      '命宮': '有主見，企圖心強，喜歡掌控，有領導力。',
      '兄弟宮': '在兄弟中有地位，可能要照顧手足。',
      '夫妻宮': '感情中想掌控，配偶可能強勢，需要協調。',
      '子女宮': '對子女有期望，可能管教嚴格。',
      '財帛宮': '財運靠努力，有掌財能力，善於理財。',
      '疾厄宮': '身體有狀況但能控制，注意不要太拼。',
      '遷移宮': '出外有發展，能掌握機會，但要努力。',
      '交友宮': '在朋友中有領導地位，可能要付出較多。',
      '官祿宮': '事業有成就，有權力地位，適合管理職。',
      '田宅宮': '對家庭有掌控，可能主導家務或房產。',
      '福德宮': '精神上有追求，喜歡掌控生活。',
      '父母宮': '父母可能嚴格，或自己要照顧長輩。',
    },
  },

  '化科': {
    name: '化科',
    nature: '名聲、學問、貴人、文雅',
    generalMeaning: [
      '代表名聲、學問、考試、貴人',
      '有文雅氣質，受人尊重',
      '適合考試、研究、學術',
      '有貴人提拔，名聲好',
      '做事有條理，重視品質',
    ],
    inPalace: {
      '命宮': '有氣質，受人尊重，有學問或名聲。',
      '兄弟宮': '兄弟姐妹有學問或名聲，相處和諧。',
      '夫妻宮': '配偶有氣質或學歷，婚姻有名分。',
      '子女宮': '子女有學業運，聰明有氣質。',
      '財帛宮': '財運靠名聲或專業，收入穩定有品質。',
      '疾厄宮': '身體問題能得到好醫療，或有養生觀念。',
      '遷移宮': '出外有名聲，受人尊重，有貴人。',
      '交友宮': '朋友有素質，交友有選擇。',
      '官祿宮': '事業有名聲，適合專業或學術領域。',
      '田宅宮': '居家環境好，有品味。',
      '福德宮': '精神生活豐富，有學習興趣。',
      '父母宮': '父母有教養，或自己重視教育。',
    },
  },

  '化忌': {
    name: '化忌',
    nature: '阻礙、執著、虧損、是非',
    generalMeaning: [
      '代表阻礙、困難、虧損、糾結',
      '該宮位的事情容易有問題',
      '可能過於執著而受苦',
      '有是非口舌或損失',
      '需要特別注意和化解',
    ],
    inPalace: {
      '命宮': '個性較悲觀或執著，一生有起伏，需要調整心態。',
      '兄弟宮': '與兄弟姐妹有摩擦，或手足有困難。',
      '夫妻宮': '感情有波折，婚姻需要經營，防第三者或爭吵。',
      '子女宮': '與子女有代溝，或子女讓人操心。',
      '財帛宮': '財運有起伏，可能有損失，要謹慎理財。',
      '疾厄宮': '身體有狀況，要特別注意健康。',
      '遷移宮': '出外有阻礙，不太順利，或容易有意外。',
      '交友宮': '朋友可能帶來麻煩，交友需謹慎。',
      '官祿宮': '事業有波折，工作上有困難或是非。',
      '田宅宮': '房產有問題，或家庭不和諧。',
      '福德宮': '精神壓力大，容易想太多或失眠。',
      '父母宮': '與父母有代溝，或父母身體要注意。',
    },
  },
};

/**
 * 獲取四化知識
 */
export function getSiHuaKnowledge(sihua: string): SiHuaKnowledge | null {
  return SIHUA_KNOWLEDGE[sihua] || null;
}

/**
 * 生成四化在特定宮位的解讀
 */
export function generateSiHuaInPalaceText(sihua: string, palace: string, starName?: string): string {
  const k = SIHUA_KNOWLEDGE[sihua];
  if (!k) return '';

  const palaceMeaning = k.inPalace[palace] || k.inPalace[palace + '宮'] || '';

  return `
【${starName ? starName + ' ' : ''}${sihua}${palace ? ` 在${palace}` : ''}】

四化本質：${k.nature}

一般含義：
${k.generalMeaning.map(m => `• ${m}`).join('\n')}

${palaceMeaning ? `\n宮位解讀：\n${palaceMeaning}` : ''}
`.trim();
}

/**
 * 解析星曜的四化
 */
export function parseStarSiHua(starInfo: { name: string; siHua?: string }): string | null {
  if (!starInfo.siHua) return null;
  return generateSiHuaInPalaceText(starInfo.siHua, '', starInfo.name);
}
